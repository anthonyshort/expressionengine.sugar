<?xml version="1.0"?>
<syntax name="text.html.ee">
	
    <zones>
		<include syntax="text.html.basic"/>
        <include collection="ee-tag"/>
        <include collection="ee-comment"/>
    </zones>

    <library>

        <collection name="ee-tag">

            <zone name="ee.tag.open">
               <starts-with>
                    <expression>(\{)(exp\:[a-zA-Z0-9_:]+)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
                    <capture number="2" name="ee.constant.name"/>
                </starts-with>
                <ends-with>
                    <expression>(/?)(\})</expression>
                    <capture number="2" name="ee.punctuation.definition.end"/>
                </ends-with>
                <subzones>
                    <zone name="constant.name.tag.ee">
						<expression>(\w*)=[\"\']([\w\-\|]*)[\"\']</expression>
						<capture number="0" name="ee.punctuation.definition.begin"/>
						<capture number="1" name="ee.tag.attribute-name"/>
						<capture number="2" name="ee.string.quoted.double"/>
					</zone> 
                </subzones>
            </zone>

            <zone name="ee.tag.close">
                <expression>(\{\/)(.+?)(\})</expression>
				<capture number="1" name="ee.punctuation.definition.begin"/>
				<capture number="2" name="constant.name"/>
				<capture number="3" name="ee.punctuation.definition.end"/>
            </zone>

			<zone name="ee.tag.open.conditional">
				<starts-with>
		            <expression>(\{)(if)[^\:](.*?)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
		            <capture number="2" name="ee.constant.name"/>
					<capture number="1" name="ee.punctuation.definition.end"/>
				</starts-with>
				<ends-with>
					<expression>(/?)(\})</expression>
					<capture number="2" name="ee.punctuation.definition.end"/>
				</ends-with>
				<subzones>
					<zone name="constant.name.tag.ee">
						<expression>(\w*)=*[\"\']([\w\-\|]*)[\"\']</expression>
						<capture number="1" name="ee.tag.attribute-name"/>
						<capture number="2" name="ee.string.quoted.double"/>
					</zone>
					<include syntax="text.html.basic" />
					<include collection="ee-tag" />
				</subzones>
			</zone>
			
			<zone name="ee.tag.self-closing">
				<starts-with>
	                    <expression>(\{)([a-zA-Z0-9_:]+)</expression>
						<capture number="1" name="ee.punctuation.definition.begin"/>
	                    <capture number="2" name="ee.constant.name"/>
	            </starts-with>
                <ends-with>
                    <expression>(/?)(\})</expression>
                    <capture number="2" name="ee.punctuation.definition.end"/>
                </ends-with>
				<subzones>
                    <zone name="constant.name.tag.ee">
						<expression>(\w*)=[\"\']([\w\-\|]*)[\"\']</expression>
						<capture number="1" name="ee.tag.attribute-name"/>
						<capture number="2" name="ee.string.quoted.double"/>
					</zone>
                </subzones>
			</zone>
			
        </collection>

        <collection name="ee-comment">
        		<zone name="processing-instruction.ee">
            		<expression>\{!--(exp\:template)--\}</expression>
            		<capture number="1" name="constant.name" />
            	</zone>
	          <zone name="comment.block.ee">
                <starts-with>
                    <expression>{!--</expression>
                </starts-with>
                <ends-with>
                    <expression>--}</expression>
                </ends-with>
            	</zone>
        </collection>

    </library>
</syntax>