<?xml version="1.0"?>
<syntax name="text.html.ee">
	
    <zones>
		<include collection="everything"/>
    </zones>

    <library>
	
		<collection name="everything">
			
			<!-- PHP -->
			<include syntax="sourcecode.php"/>

			<!-- SQL -->
			<zone name="string.quoted.double.sql">
	            <starts-with>
	                <expression></expression>
					<expression>(\w*)\s*(=*)\s*"\s*(?=(SELECT|INSERT|UPDATE|DELETE|CREATE|REPLACE|ALTER)\b)</expression>
	                <capture number="0" name="punctuation.definition.string.begin.php"/>
	            </starts-with>
	            <ends-with>
	                <expression>"</expression>
	                <capture number="0" name="punctuation.definition.string.end.php"/>
	            </ends-with>
	            <subzones name="source.sql.embedded">
	            	<include syntax="sourcecode.sql" />
				</subzones>
	        </zone>

			<!-- HTML/CSS/JS -->
			<include syntax="text.html.basic"/>

			<!-- EE -->
			<include collection="ee-comment"/>
	        <include collection="ee-tag"/>
	
		</collection>

        <collection name="ee-tag">
	
			<zone name="ee.tag.self-closing.conditional">
				<starts-with>
	                <expression>\s*(\{)(if\:else|if\:elseif|if|\/if)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
	                <capture number="2" name="ee.entity.name"/>
	            </starts-with>
                <ends-with>
                    <expression>(/?)(\})\s*</expression>
                    <capture number="2" name="ee.punctuation.definition.end"/>
                </ends-with>
				<subzones>
					<include collection="ee-tag-attributes" />
                </subzones>
			</zone>
			
			<!-- <zone name="ee.tag.open.conditional">
		       <starts-with>
				<expression>(\{)(if)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
                    <capture number="2" name="ee.entity.name"/>
		        </starts-with>
				<ends-with>
					<expression>(/?)(})</expression>
					<capture number="2" name="ee.punctuation.definition.end"/>
				</ends-with>
				<subzones>
					<include collection="ee-tag-attributes" />
				</subzones>
			</zone>
			
			<zone name="ee.tag.close.conditional">
	            <expression>({/)(if)(})</expression>
				<capture number="1" name="ee.punctuation.definition.begin"/>
               	<capture number="2" name="ee.entity.name"/>
				<capture number="3" name="ee.punctuation.definition.end"/>
			</zone> -->
			
			<zone name="ee.tag.open">
		       <starts-with>
				<expression>(\{)(exp:[a-zA-Z0-9:_]+|categories|date_heading|date_footer|entry_titles)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
                    <capture number="2" name="ee.entity.name"/>
		        </starts-with>
				<ends-with>
					<expression>(/?)(})</expression>
					<capture number="2" name="ee.punctuation.definition.end"/>
				</ends-with>
				<subzones>
					<include collection="ee-tag-attributes" />
				</subzones>
			</zone>
			
			<zone name="ee.tag.close">
		        <starts-with>
		            <expression>({/)([a-zA-Z0-9:]+)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
                 	<capture number="2" name="ee.entity.name"/>
		        </starts-with>
				<ends-with>
					<expression>(})</expression>
					<capture number="1" name="ee.punctuation.definition.end"/>
				</ends-with>
			</zone>
		
			<zone name="ee.tag.self-closing">
				<starts-with>
	                <expression>(\{)([a-zA-Z0-9_:]+|if\:else|if\:elseif)</expression>
					<capture number="1" name="ee.punctuation.definition.begin"/>
	                <capture number="2" name="ee.entity.name"/>
	            </starts-with>
                <ends-with>
                    <expression>(/?)(\})</expression>
                    <capture number="2" name="ee.punctuation.definition.end"/>
                </ends-with>
				<subzones>
					<include collection="ee-tag-attributes" />
                </subzones>
			</zone>
			
        </collection>

		<collection name="ee-tag-attributes">
			<zone name="ee.attribute">
				<starts-with>
					<expression>(\w*)\s*(=*)\s*([\"\'])</expression>
					<capture number="1" name="ee.attribute-name"/>
					<capture number="2" name="ee.operator"/>
					<capture number="3" name="ee.punctuation.definition.begin"/>
				</starts-with>
				<ends-with>
					<expression>(/?)([\"\'])</expression>
					<capture number="1" name="ee.attribute-value"/>
					<capture number="2" name="ee.punctuation.definition.end"/>
				</ends-with>
				<subzones>
					<include collection="everything" />
				</subzones>
			</zone>
		</collection>
        
        <collection name="ee-comment">
	          <zone name="comment.block.ee">
                <starts-with>
                    <expression>{!--</expression>
                </starts-with>
                <ends-with>
                    <expression>--}</expression>
                </ends-with>
            	</zone>
        </collection>
       
    </library>
</syntax>